{% extends "analyze.txt.j2" %}


{% block body %}
{%- if msg.flagged_rule_results|length > 0 %}
{# new line #}
<header>FLAGGED RULES</header>
{%- for rule in msg.flagged_rule_results %}
  - <detected><bold>{{ rule.name }}</bold> flagged this message.</detected>
    <key>Source:</key> {{ rule.source }}
  {# new line #}
{%- endfor %}
{# new line #}
{%- endif %}


{%- if msg.unflagged_rule_results|length > 0 %}
{# new line #}
<header>UNFLAGGED RULES</header>
{%- for rule in msg.unflagged_rule_results %}
  - <not-detected><bold>{{ rule.name }}</bold> did not flag.</not-detected>
    <key>Source:</key> {{ rule.source }}
  {# new line #}
{%- endfor %}
{# new line #}
{%- endif %}


{%- if (msg.normal_query_results + msg.falsey_query_results) | length > 0 %}
{# new line #}
<header>QUERIES</header>
{%- for query in (msg.normal_query_results + msg.falsey_query_results) %}
  - <query><bold>{{ query.name }}</bold></query>
    <key>Result:</key> {{ query.result }}
    <key>Source:</key> {{ query.source }}
  {# new line #}
{%- endfor %}
{# new line #}
{%- endif %}


{%- if msg.failed_rule_results|length > 0 %}
{# new line #}
<header>FAILED RULES</header>
{%- for rule in msg.failed_rule_results %}
  - <fail><bold>{{ rule.name }}</bold></fail>
    <key>Source:</key> {{ rule.source }}
  {# new line #}
{%- endfor %}
{# new line #}
{%- endif %}


{%- if msg.failed_query_results|length > 0 %}
{# new line #}
<header>FAILED QUERIES</header>
{%- for query in msg.failed_query_results %}
  - <fail><bold>{{ query.name }}</bold></fail>
    <key>Source:</key> {{ query.source }}
  {# new line #}
{%- endfor %}
{# new line #}
{%- endif %}
{% endblock %}
