╔═══════════════════════════╗
║ <header>{{ "{:^25}".format("Results") }}</header> ║
╚═══════════════════════════╝

{# new line #}
<header>SUMMARY</header>
==================
<key>Total Rules</key>: <value>{{stats.total_rules}}</value>
<key>Total Queries</key>: <value>{{stats.total_queries}}</value>
<key>Total Messages</key>: <value>{{stats.total_messages}}</value>

<key>Flagged Rules</key>: <value>{{stats.flagged_rules}}</value>
<key>Flagged Messages</key>: <value>{{stats.flagged_messages}}</value>


{%- if flagged_messages|length > 0 %}
{# new line #}
{# new line #}
<header>FLAGGED MESSAGES</header>
==================
{%- endif %}

{%- for msg in flagged_messages %}
  {# new line #}
  <header>MESSAGE {{loop.index}}</header>
  ------------------
  <key>File Name</key>: <value>{{msg.file_name}}</value>
  <key>Directory</key>: <value>{{msg.directory}}</value>

    {# new line #}
    <header>RULES FLAGGED</header>
    {%- if verbose %}
    {%- for rule in msg.flagged_rule_results %}
      - <detected><bold>{{ rule.name }}</bold> flagged this message.</detected>
        <key>Source:</key> {{ rule.source }}
      {# new line #}
    {%- endfor %}

    {%- else %}
    {%- for rule in msg.flagged_rule_results %}
      - <detected>{{rule.name}}</detected>
    {%- endfor %}
    {%- endif %}


    {%- if msg.unflagged_rule_results|length > 0 %}
    {# new line #}
    <header>RULES NOT FLAGGED</header>
    {%- if verbose %}
    {%- for rule in msg.unflagged_rule_results %}
      - <not-detected><bold>{{ rule.name }}</bold> did not flag.</not-detected>
        <key>Source:</key> {{ rule.source }}
      {# new line #}
    {%- endfor %}
    
    {%- else %}
    {%- for rule in msg.unflagged_rule_results %}
      - <not-detected>{{rule.name}}</not-detected>
    {%- endfor %}
    {%- endif %}
    {%- endif %}


    {%- if msg.query_results|length > 0 %}
    {# new line #}
    <header>QUERIES</header>
    {%- if verbose %}
    {%- for query in msg.query_results %}
      {%- if query.success %}
      - <detected><bold>{{ query.name }}</bold></detected>
        <key>Result:</key> {{ query.result }}
        <key>Source:</key> {{ query.source }}
      {%- else %}
      - <fail><bold>{{ query.name }}</bold> failed to run.</fail>
      {%- endif %}
      {# new line #}
    {%- endfor %}
    
    {%- else %}
    {%- for query in msg.query_results %}
      {%- if query.success %}
      - <detected>{{ query.name }}</detected>
        <key>Result:</key> {{ query.result }}
      {%- else %}
      - <fail>{{ query.name }} failed to run.</fail>
      {%- endif %}
      {# new line #}
    {%- endfor %}
    {%- endif %}
    {%- endif %}

    {# new line #}
{% endfor %}



{%- if unflagged_messages|length > 0 %}
{# new line #}
<header>UNFLAGGED MESSAGES</header>
==================
{%- endif %}

{%- for msg in unflagged_messages %}
{# new line #}
  <header>MESSAGE {{loop.index}}</header>
  ------------------
  <key>File Name</key>: <value>{{msg.file_name}}</value>
  <key>Directory</key>: <value>{{msg.directory}}</value>


    {%- if msg.query_results|length > 0 %}
    {# new line #}
    <header>QUERIES</header>
    {%- if verbose %}
    {%- for query in msg.query_results %}
      {%- if query.success %}
      - <detected><bold>{{ query.name }}</bold></detected>
        <key>Result:</key> {{ query.result }}
        <key>Source:</key> {{ query.source }}
      {%- else %}
      - <fail><bold>{{ query.name }}</bold> failed to run.</fail>
      {%- endif %}
      {# new line #}
    {%- endfor %}
    
    {%- else %}
    {%- for query in msg.query_results %}
      {%- if query.success %}
      - <detected>{{ query.name }}</detected>
        <key>Result:</key> {{ query.result }}
      {%- else %}
      - <fail>{{ query.name }} failed to run.</fail>
      {%- endif %}
      {# new line #}
    {%- endfor %}
    {%- endif %}
    {%- endif %}

    {# new line #}
{% endfor %}