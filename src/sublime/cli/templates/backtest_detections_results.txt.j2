╔═══════════════════════════╗
║ <header>{{ "{:^25}".format("Results") }}</header> ║
╚═══════════════════════════╝

<key>Total messages analyzed: </key><bold>{{ total_messages_analyzed }}</bold>
<key>Total messages flagged: </key><bold>{{ total_messages_flagged }}</bold>
<key>Total new messages flagged: </key><bold>{{ total_new_messages_flagged }}</bold>

{{ "" }}
  <header>DETECTIONS BACKTESTED</header>
----------------------------
{%- for detection in detections %}
{%- if detection.name %}
<key>Name: </key><light-yellow>{{ detection.name }}</light-yellow>
{%- elif detection.detection_id %}
<key>Detection ID: </key><dim>{{ detection.detection_id }}</dim>
{%- elif detection.detection %}
<key>Raw Detection:</key> <bold>{{ detection.detection }}</bold>
{{ "" }}
{%- endif %}
{%- endfor %}

  <header>FLAGGED MESSAGES</header>
----------------------------
{%- if results -%}
{%- for result in results %}
{%- if result.result %}
<detected><bold>RESULT {{ loop.index }}</bold></detected>
{%- else %}
<not-detected><bold>RESULT {{ loop.index }}</bold></not-detected>
{%- endif %}
<key>Subject: </key><bold>{{ result.subject }}</bold>
<key>Sender:</key> <bold>{{ result.sender_display_name }} <{{result.sender_email_address}}></bold>
<key>Mailbox:</key> <bold>{{ result.mailbox_email_address }}</bold>
<key>MDM ID: </key><dim>{{ result.message_data_model_id }}</dim>
<key>Created: </key><dim>{{ result.created_at }}</dim>
<key>Detections flagged:</key><bold>{% for detection in result.detections_flagged %}{% if detection.name %} {{ detection.name }}{% elif detection.detection_id %} {{ detection.detection_id }}{% else %} <detection name not set>{% endif %}{% endfor %}</bold>
<key>Prior detections flagged: </key><bold>{% for detection in result.prior_detections_flagged %}{% if detection.name %} {{ detection.name }}{% elif detection.detection_id %} {{ detection.detection_id }}{% else %} <detection name not set>{% endif %}{% endfor %}</bold>
{{ "" }}
{%- endfor %}
{%- else -%}
{{ "" }}
No flagged messages
{%- endif -%}
